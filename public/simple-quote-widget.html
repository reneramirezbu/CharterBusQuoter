<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Charter Bus Quote Widget</title>
  <link rel="stylesheet" href="/quote-widget.css">
  <script>
    // Wait for Google Maps API to load from our other script
    document.addEventListener('DOMContentLoaded', function() {
      // Load Google Maps API
      const script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initAutocomplete';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
      
      // Function to initialize autocomplete after API loads
      window.initAutocomplete = function() {
        // Initialize autocomplete for pickup location
        new google.maps.places.Autocomplete(
          document.getElementById('pickup-location'),
          {types: ['address']}
        );
        
        // Initialize autocomplete for dropoff location
        new google.maps.places.Autocomplete(
          document.getElementById('dropoff-location'),
          {types: ['address']}
        );
      };
      
      // Set up navigation between steps
      setupNavigation();
    });
    
    function setupNavigation() {
      // Show first step by default
      showStep(1);
      
      // Button click handlers
      document.getElementById('next-button').addEventListener('click', function() {
        if (validateStep1()) {
          showStep(2);
        }
      });
      
      document.getElementById('back-button').addEventListener('click', function() {
        showStep(1);
      });
      
      document.getElementById('get-quote-button').addEventListener('click', function() {
        showStep(3);
        calculateQuote();
      });
      
      // Trip type change handler
      document.getElementById('trip-type').addEventListener('change', function() {
        const returnContainer = document.getElementById('return-date-container');
        if (this.value === 'round-trip') {
          returnContainer.style.display = 'block';
        } else {
          returnContainer.style.display = 'none';
        }
      });
    }
    
    function showStep(stepNumber) {
      // Hide all steps
      document.querySelectorAll('.form-step').forEach(step => {
        step.style.display = 'none';
      });
      
      // Show selected step
      document.getElementById(`step-${stepNumber}`).style.display = 'block';
      
      // Update progress indicator
      document.querySelectorAll('.progress-bar .step').forEach((step, index) => {
        if (index + 1 === stepNumber) {
          step.classList.add('active');
        } else {
          step.classList.remove('active');
        }
      });
    }
    
    function validateStep1() {
      // Simple validation - make sure required fields are completed
      const requiredFields = ['trip-type', 'pickup-location', 'dropoff-location', 'departure-date', 'passenger-count'];
      let valid = true;
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value) {
          valid = false;
          // Add error styling or message here
          field.style.borderColor = 'red';
        } else {
          field.style.borderColor = '#ccc';
        }
      });
      
      // Validate return date if round trip
      if (document.getElementById('trip-type').value === 'round-trip') {
        const returnDate = document.getElementById('return-date');
        if (!returnDate.value) {
          valid = false;
          returnDate.style.borderColor = 'red';
        } else {
          returnDate.style.borderColor = '#ccc';
        }
      }
      
      return valid;
    }
    
    function calculateQuote() {
      // Get form values
      const tripType = document.getElementById('trip-type').value;
      const pickupLocation = document.getElementById('pickup-location').value;
      const dropoffLocation = document.getElementById('dropoff-location').value;
      const passengerCount = document.getElementById('passenger-count').value;
      
      // Get selected amenities
      const amenities = [];
      document.querySelectorAll('input[name="amenities"]:checked').forEach(checkbox => {
        amenities.push(checkbox.value);
      });
      
      // Calculate a simple mock quote (in real usage, you'd call your API)
      const basePrice = 800; // Standard charter bus price
      const distanceFactor = 1.5; // Mock distance multiplier
      
      let total = basePrice * distanceFactor;
      
      // Add 80% for round trip (20% discount)
      if (tripType === 'round-trip') {
        total *= 1.8;
      }
      
      // Add $50 per amenity
      total += amenities.length * 50;
      
      // Add 10% service fee
      const serviceFee = total * 0.1;
      const finalTotal = total + serviceFee;
      
      // Display the quote
      document.getElementById('quote-total').textContent = '$' + finalTotal.toFixed(2);
      document.getElementById('quote-pickup').textContent = pickupLocation;
      document.getElementById('quote-dropoff').textContent = dropoffLocation;
      document.getElementById('quote-passengers').textContent = passengerCount;
      document.getElementById('quote-trip-type').textContent = tripType === 'one-way' ? 'One Way' : 'Round Trip';
      document.getElementById('quote-amenities').textContent = amenities.length ? amenities.join(', ') : 'None';
    }
  </script>
</head>
<body>

<div id="charter-quote-widget" class="charter-quote-widget">
  <h2>Charter Bus Quote</h2>
  
  <form id="quote-form">
    <!-- Progress Steps -->
    <div class="progress-bar">
      <div class="step active">1</div>
      <div class="step">2</div>
      <div class="step">3</div>
    </div>
    
    <!-- Step 1: Trip Details -->
    <div id="step-1" class="form-step">
      <div class="form-group">
        <label for="trip-type">Trip Type</label>
        <select id="trip-type" required>
          <option value="">Select Trip Type</option>
          <option value="one-way">One Way</option>
          <option value="round-trip">Round Trip</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="pickup-location">Pickup Location</label>
        <input type="text" id="pickup-location" placeholder="Enter pickup address" required>
      </div>
      
      <div class="form-group">
        <label for="dropoff-location">Dropoff Location</label>
        <input type="text" id="dropoff-location" placeholder="Enter dropoff address" required>
      </div>
      
      <div class="form-group">
        <label for="departure-date">Departure Date</label>
        <input type="date" id="departure-date" required>
      </div>
      
      <div id="return-date-container" class="form-group" style="display: none;">
        <label for="return-date">Return Date</label>
        <input type="date" id="return-date">
      </div>
      
      <div class="form-group">
        <label for="passenger-count">Number of Passengers</label>
        <input type="number" id="passenger-count" min="1" required>
      </div>
      
      <button type="button" id="next-button">Next</button>
    </div>
    
    <!-- Step 2: Amenities (Bus Type is hidden/preset) -->
    <div id="step-2" class="form-step">
      <h3>Additional Amenities</h3>
      
      <div class="amenities-options">
        <div class="amenity-option">
          <input type="checkbox" id="wifi" name="amenities" value="WiFi">
          <label for="wifi">WiFi</label>
        </div>
        
        <div class="amenity-option">
          <input type="checkbox" id="lavatory" name="amenities" value="Lavatory">
          <label for="lavatory">Lavatory</label>
        </div>
        
        <div class="amenity-option">
          <input type="checkbox" id="entertainment" name="amenities" value="Entertainment">
          <label for="entertainment">Entertainment</label>
        </div>
        
        <div class="amenity-option">
          <input type="checkbox" id="power" name="amenities" value="Power Outlets">
          <label for="power">Power Outlets</label>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="button" id="back-button" class="btn-secondary">Back</button>
        <button type="button" id="get-quote-button">Get Quote</button>
      </div>
    </div>
    
    <!-- Step 3: Quote Results -->
    <div id="step-3" class="form-step">
      <div class="results">
        <h3>Your Charter Bus Quote</h3>
        
        <p><strong>Trip Type:</strong> <span id="quote-trip-type"></span></p>
        <p><strong>Pickup:</strong> <span id="quote-pickup"></span></p>
        <p><strong>Dropoff:</strong> <span id="quote-dropoff"></span></p>
        <p><strong>Passengers:</strong> <span id="quote-passengers"></span></p>
        <p><strong>Amenities:</strong> <span id="quote-amenities"></span></p>
        <p><strong>Total Price:</strong> <span id="quote-total"></span></p>
      </div>
      
      <button type="button" id="book-now-button">Book Now</button>
    </div>
  </form>
</div>

</body>
</html>